<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:dlapp.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="720" d:DesignHeight="520"
        x:Class="dlapp.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/logo.png"
        Title="KAMO Video Downloader"
        Width="720" Height="520"
        MinWidth="640" MinHeight="480"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource Background}">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto" Margin="24">

        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12">
            <Image Source="/Assets/logo.png" Width="32" Height="32"/>
            <TextBlock Text="KAMO" FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextPrimary}"/>
            <TextBlock Text="Video Downloader" FontSize="14" VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}"/>
            <Rectangle/>
            <TextBlock Text="v1.0.0" FontSize="11" VerticalAlignment="Center" Foreground="{StaticResource TextTertiary}"/>
        </StackPanel>

        <Grid Grid.Row="1" RowDefinitions="Auto,Auto,Auto,Auto,Auto,*,Auto" Margin="0,24">

            <StackPanel Grid.Row="0" Spacing="6">
                <TextBlock Text="URL" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                <TextBox Text="{Binding Url}"
                         Watermark="https://youtube.com/watch?v=..."
                         UseFloatingWatermark="False"
                         IsEnabled="{Binding !IsBusy}"/>
            </StackPanel>

            <StackPanel Grid.Row="1" Spacing="6" Margin="0,16">
                <TextBlock Text="SAVE TO" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                <Grid ColumnDefinitions="*,Auto">
                    <TextBox Grid.Column="0"
                             Text="{Binding SavePath}"
                             IsReadOnly="True"
                             Watermark="Select folder..."
                             IsEnabled="{Binding !IsBusy}"/>
                    <Button Grid.Column="1"
                            Classes="secondary"
                            Content="Browse"
                            Command="{Binding SelectSavePathCommand}"
                            Margin="8,0,0,0"
                            IsEnabled="{Binding !IsBusy}"/>
                </Grid>
            </StackPanel>

            <StackPanel Grid.Row="2" Spacing="6" Margin="0,8">
                <TextBlock Text="MODE" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <RadioButton GroupName="Format" Content="Video + Audio"
                                 IsChecked="{Binding !IsAudioOnly}"
                                 IsEnabled="{Binding !IsBusy}"/>
                    <RadioButton GroupName="Format" Content="Audio Only"
                                 IsChecked="{Binding IsAudioOnly}"
                                 IsEnabled="{Binding !IsBusy}"/>
                </StackPanel>
                <CheckBox Content="Playlist"
                          IsChecked="{Binding IsPlaylist}"
                          IsEnabled="{Binding !IsBusy}"
                          Margin="0,4"/>
            </StackPanel>

            <Grid Grid.Row="3" ColumnDefinitions="*,*" Margin="0,16">
                <StackPanel Grid.Column="0" Spacing="6">
                    <TextBlock Text="QUALITY" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                    <ComboBox ItemsSource="{Binding Resolutions}"
                              SelectedItem="{Binding SelectedResolution}"
                              IsEnabled="{Binding !IsBusy}"
                              IsVisible="{Binding !IsAudioOnly}"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Spacing="6">
                    <TextBlock Text="FORMAT" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                    <ComboBox ItemsSource="{Binding VideoFormats}"
                              SelectedItem="{Binding SelectedVideoFormat}"
                              IsEnabled="{Binding !IsBusy}"
                              IsVisible="{Binding !IsAudioOnly}"/>
                </StackPanel>
            </Grid>

            <StackPanel Grid.Row="4" Spacing="6" Margin="0,16" IsVisible="{Binding IsAudioOnly}">
                <TextBlock Text="FORMAT" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                <ComboBox ItemsSource="{Binding AudioFormats}"
                          SelectedItem="{Binding SelectedAudioFormat}"
                          IsEnabled="{Binding !IsBusy}"/>
            </StackPanel>

            <Button Grid.Row="5"
                    Classes="primary"
                    Content="DOWNLOAD"
                    Command="{Binding DownloadCommand}"
                    Margin="0,8"
                    IsEnabled="{Binding !IsBusy}"/>

            <Border Grid.Row="5" Margin="0,16" Background="{StaticResource Surface}" CornerRadius="8">
                <ListBox ItemsSource="{Binding Items}"
                         Background="Transparent"
                         Padding="0">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="30,*,Auto" Margin="12,10">
                                <TextBlock Text="{Binding Index}" Foreground="{StaticResource TextTertiary}" VerticalAlignment="Center" FontFamily="{StaticResource FontMonospace}" FontSize="12"/>
                                <TextBlock Grid.Column="1" Text="{Binding Title}" Foreground="{StaticResource TextPrimary}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis" Margin="10,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding Status}" FontSize="11" FontWeight="500" VerticalAlignment="Center">
                                    <TextBlock.Styles>
                                        <Style Selector="TextBlock[Text=Pending]">
                                            <Setter Property="Foreground" Value="{StaticResource TextTertiary}"/>
                                        </Style>
                                        <Style Selector="TextBlock[Text=Downloading...]">
                                            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                        </Style>
                                        <Style Selector="TextBlock[Text=Completed]">
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                        </Style>
                                    </TextBlock.Styles>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>
        </Grid>

        <StackPanel Grid.Row="2" Spacing="4">
            <ProgressBar Value="{Binding ProgressValue}"
                         Maximum="100"
                         Height="3"
                         IsVisible="{Binding IsBusy}"/>
            <TextBlock Text="{Binding StatusMessage}"
                       FontSize="11"
                       Foreground="{StaticResource TextSecondary}"
                       HorizontalAlignment="Center"
                       TextTrimming="CharacterEllipsis"/>
        </StackPanel>
    </Grid>
</Window>
